# Laravel Queue Worker Configuration for Supervisor
#
# This configuration file defines how Supervisor manages Laravel queue workers.
# Used in production environment with multiple worker processes.
#
# Configuration:
# - numprocs: Number of worker processes (controlled by LARADOX_QUEUE_WORKERS env var)
# - timeout: Set to 0 for unlimited processing time
# - sleep: Wait 3 seconds when no jobs are available
# - tries: Maximum 3 attempts per job before marking as failed
#
# Environment Variables:
# - LARADOX_QUEUE_WORKERS: Number of worker processes to spawn (default: 2)
#   Set in docker-compose.production.yml or .env file
#
# Example .env configuration:
#   LARADOX_QUEUE_WORKERS=4
#
# Monitor workers:
#   docker compose exec queue supervisorctl status
#   docker compose exec queue supervisorctl restart laravel-worker:*

[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /srv/artisan queue:work --timeout=0 --sleep=3 --tries=3
autostart=true
autorestart=true
user=appuser
numprocs=%(ENV_LARADOX_QUEUE_WORKERS)s
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stopsignal=QUIT
stopwaitsecs=3600
